Case Study #3: Foodie-Fi

A. Customer Journey

-- Based off the 8 sample customers provided in the sample subscriptions table below, write a brief description about each customerâ€™s onboarding journey.
SELECT 
	s.customer_id, 
	s.plan_id, 
	p.plan_name, 
	s.start_date
FROM subscriptions s
JOIN plans p
	ON s.plan_id = p.plan_id
WHERE s.customer_id IN(1,2,11,13,15,16,18,19);

B. Data Analysis Questions

1. How many customers has Foodie-Fi ever had?
SELECT COUNT(DISTINCT customer_id) as number_customer
FROM subscriptions

2. What is the monthly distribution of trial plan start_date values for our dataset - use the start of the month as the group by value.
SELECT	
	DATEPART(MONTH, start_date) as month_view, 
	COUNT(plan_id) AS number_user
FROM subscriptions
WHERE plan_id = 0
GROUP BY DATEPART(MONTH, start_date)
ORDER BY month_view

3.What plan start_date values occur after the year 2020 for our dataset? Show the breakdown by count of events for each plan_name.
SELECT 
	s.plan_id, 
	p.plan_name, 
	COUNT(s.plan_id) as number_register
FROM subscriptions s
JOIN plans p
	ON s.plan_id = p.plan_id
WHERE YEAR(s.start_date) > 2020
GROUP BY p.plan_name, s.plan_id;

4. What is the customer count and percentage of customers who have churned rounded to 1 decimal place?
-- Way 1
WITH churn_and_all_customer AS (
SELECT 
	COUNT(DISTINCT s.customer_id) as all_customer, 
	SUM(CASE 
			WHEN p.plan_name = 'churn' THEN 1
			ELSE 0
			END) as churn_customer
	
FROM subscriptions s
JOIN plans p
	ON s.plan_id = p.plan_id
)
SELECT churn_customer, all_customer, ROUND((churn_customer*100.0/all_customer),2) as percent_churn
FROM churn_and_all_customer

-- Way 2
SELECT COUNT(s.customer_id) AS number_churn,
       (COUNT(s.customer_id) * 100.0)/
  (SELECT COUNT(DISTINCT customer_id)
   FROM subscriptions) AS a
FROM subscriptions s
JOIN plans p ON s.plan_id = p.plan_id
WHERE p.plan_id = 4